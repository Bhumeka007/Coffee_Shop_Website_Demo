{% load static %}
{% load widget_tweaks %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Our Outlets | KohiKohi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Custom Style -->
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        h2 {
            text-align: center;
            padding: 20px 10px 10px;
            color: #46211A;
        }

        .map-frame iframe {
            width: 100%;
            height: 100%;
            min-height: 300px;
            border: none;
            border-radius: 10px;
        }

        #map select.form-select {
            max-width: 100%;
            font-weight: 500;
        }

        #map {
            height: 80vh;
            width: 100%;
            margin-top: 10px;
        }

        .text-coffee {
            color: #46211A;
        }

        .map-container {
            width: 100%;
            height: 100%;
            min-height: 350px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }

        .filter-container {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        select {
            padding: 8px 16px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .leaflet-popup-content-wrapper {
            font-size: 15px;
            font-weight: 500;
        }
    </style>
</head>

<body>

    <section class="container my-5" id="map">
        <div class="text-center mb-5">
            <h2 class="fw-bold text-coffee display-6">üìç Find Our Outlets</h2>
            <p class="text-muted fs-6">Select a location to view the address and directions</p>
        </div>

        <!-- Selection + Address + Map -->
        <div class="card shadow-lg p-4 rounded-4 border-0 bg-white">
            <div class="row gy-4">
                <!-- Dropdown & Address -->
                <div class="col-lg-5 d-flex flex-column justify-content-between">
                    <div>
                        <label for="locationSelect" class="form-label fw-semibold text-dark">Choose Outlet:</label>
                        <select id="locationSelect" class="form-select shadow-sm mb-3">
                            <option value="0">Dhanmondi-27, Hope Building</option>
                            <option value="1">Banani-11, Platinum Tower</option>
                            <option value="2">Gulshan-2, Lake View Plaza</option>
                            <option value="3">Uttara Sector-3, North Hub</option>
                        </select>

                        <div class="bg-light p-3 rounded border">
                            <h6 class="fw-bold text-coffee mb-2">üìå Outlet Address</h6>
                            <p class="mb-0 text-muted" id="outletAddress">Dhanmondi-27, Hope Building, street-07,
                                Road-B, Dhaka-1306</p>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="mt-4 d-flex flex-wrap gap-2">
                        <a href="#" target="_blank" id="directionsLink" class="btn btn-outline-dark flex-fill">
                            üß≠ Show Directions
                        </a>
                        <button class="btn btn-outline-primary flex-fill" onclick="getCurrentLocation()">
                            üìç Use My Location
                        </button>
                        <a href="{% url 'home' %}" class="btn btn-outline-secondary flex-fill">
                            üè† Back to Home
                        </a>
                    </div>
                </div>

                <!-- Embedded Map -->
                <div class="col-lg-7">
                    <div class="map-container rounded overflow-hidden border shadow-sm">
                        <iframe id="mapIframe" width="100%" height="350" style="border:0;" allowfullscreen
                            loading="lazy"
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3651.796374447295!2d90.37005721538504!3d23.750903984587887!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3755bebe9c9792b5%3A0x16e9a10f5c3e7b70!2sDhanmondi-27%20Hope%20Building!5e0!3m2!1sen!2sbd!4v1655979589792">
                        </iframe>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!--<div class="filter-container">
        <select id="location-select">
            <option value="" disabled selected>Choose an Outlet</option>
            <option value="0">Outlet 1 - Dhaka</option>
            <option value="1">Outlet 2 - Chittagong</option>
            <option value="2">Outlet 3 - Sylhet</option>
            <option value="3">Outlet 4 - Rangpur</option>
        </select>
    </div>-->

    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        const addresses = [
            "Dhanmondi-27, Hope Building, street-07, Road-B, Dhaka-1306",
            "Banani-11, Platinum Tower, Dhaka-1213",
            "Gulshan-2, Lake View Plaza, Dhaka-1212",
            "Uttara Sector-3, North Hub, Dhaka-1230"
        ];

        const mapLinks = [
            "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3651.796374447295!2d90.37005721538504!3d23.750903984587887!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3755bebe9c9792b5%3A0x16e9a10f5c3e7b70!2sDhanmondi-27%20Hope%20Building!5e0!3m2!1sen!2sbd!4v1655979589792",
            "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3650.993313482118!2d90.4082446153857!3d23.79252018456968!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3755c70e16fdc0b1%3A0xe49d917f9d07b133!2sPlatinum%20Tower%2C%20Banani!5e0!3m2!1sen!2sbd!4v1655979751294",
            "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3650.548142024257!2d90.41621611538594!3d23.81054418456202!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3755c7a859f776eb%3A0xabc896abc7!2sLake%20View%20Plaza%2C%20Gulshan-2!5e0!3m2!1sen!2sbd!4v1655979801820",
            "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3649.937343507598!2d90.39624861538625!3d23.836582384552086!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3755c5f6ad79bc3f%3A0x6972b1c3d8fce3a6!2sUttara%20Sector%203!5e0!3m2!1sen!2sbd!4v1655979859315"
        ];

        const gmapsLinks = [
            "https://www.google.com/maps/dir/?api=1&destination=Dhanmondi-27,+Hope+Building,+street-07,+Road-B,+Dhaka-1306",
            "https://www.google.com/maps/dir/?api=1&destination=Banani-11,+Platinum+Tower,+Dhaka-1213",
            "https://www.google.com/maps/dir/?api=1&destination=Gulshan-2,+Lake+View+Plaza,+Dhaka-1212",
            "https://www.google.com/maps/dir/?api=1&destination=Uttara+Sector-3,+North+Hub,+Dhaka-1230"
        ];

        document.getElementById("locationSelect").addEventListener("change", function () {
            const index = this.value;
            document.getElementById("outletAddress").textContent = addresses[index];
            document.getElementById("mapIframe").src = mapLinks[index];
            document.getElementById("directionsLink").href = gmapsLinks[index];
        });

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const gmapsUrl = `https://www.google.com/maps/@${lat},${lng},15z`;
                    window.open(gmapsUrl, '_blank');
                }, () => {
                    alert("Couldn't access your location. Please enable GPS.");
                });
            } else {
                alert("Geolocation is not supported by your browser.");
            }
        }
    </script>

    <!--<script>
        const outlets = [
            { lat: 23.8103, lng: 90.4125, name: "Outlet 1 - Dhaka" },
            { lat: 22.3475, lng: 91.8123, name: "Outlet 2 - Chittagong" },
            { lat: 24.9045, lng: 91.8611, name: "Outlet 3 - Sylhet" },
            { lat: 25.7439, lng: 89.2752, name: "Outlet 4 - Rangpur" }
        ];

        const map = L.map('map').setView([23.8103, 90.4125], 6.5);

        // Load tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Add markers
        outlets.forEach(outlet => {
            L.marker([outlet.lat, outlet.lng]).addTo(map).bindPopup(outlet.name);
        });

        // Handle dropdown change
        document.getElementById("location-select").addEventListener("change", function () {
            const selected = outlets[this.value];
            map.setView([selected.lat, selected.lng], 14);
        });
    </script>-->
</body>

</html>